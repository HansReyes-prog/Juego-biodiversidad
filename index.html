<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego Corregido</title>
    <!-- PyScript -->
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #ffffff;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        canvas {
            border: 1px solid #ffffff;
            margin: 20px auto;
            display: block;
        }
        #score {
            font-size: 1.5em;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Juego Corregido</h1>
    <p id="score">Puntuación: 0</p>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <py-script>
        from js import document, window

        # ** Constantes **
        ANCHO = 800
        ALTO = 600
        VELOCIDAD = 5
        COLOR_FONDO = "#121212"
        PUNTOS_GANAR = 100
        URL_PERSONAJE = "https://via.placeholder.com/40x40.png?text=P"  # Reemplaza con tu sprite
        URL_ENEMIGO = "https://via.placeholder.com/30x30.png?text=E"    # Reemplaza con tu sprite

        # ** Clase Personaje **
        class Personaje:
            def __init__(self, x, y, image_url):
                self.x = x
                self.y = y
                self.w = 40
                self.h = 40
                self.vel = VELOCIDAD
                self.image = window.Image.new()
                self.image.src = image_url

            def mover(self, keys):
                if "ArrowUp" in keys:
                    self.y -= self.vel
                if "ArrowDown" in keys:
                    self.y += self.vel
                if "ArrowLeft" in keys:
                    self.x -= self.vel
                if "ArrowRight" in keys:
                    self.x += self.vel

            def dibujar(self, ctx):
                ctx.drawImage(self.image, self.x, self.y, self.w, self.h)

        # ** Clase Enemigo **
        class Enemigo:
            def __init__(self, x, y, image_url):
                self.x = x
                self.y = y
                self.w = 30
                self.h = 30
                self.image = window.Image.new()
                self.image.src = image_url

            def dibujar(self, ctx):
                ctx.drawImage(self.image, self.x, self.y, self.w, self.h)

            def colisiona(self, jugador):
                return (
                    self.x < jugador.x + jugador.w and
                    self.x + self.w > jugador.x and
                    self.y < jugador.y + jugador.h and
                    self.y + self.h > jugador.y
                )

        # ** Clase Juego **
        class Juego:
            def __init__(self):
                self.canvas = document.getElementById("gameCanvas")
                self.ctx = self.canvas.getContext("2d")
                self.jugador = Personaje(100, 100, URL_PERSONAJE)
                self.enemigos = [Enemigo(400, 300, URL_ENEMIGO), Enemigo(200, 500, URL_ENEMIGO)]
                self.puntuacion = 0
                self.keys = set()

                # Event Listeners para teclado
                window.addEventListener("keydown", self.key_down)
                window.addEventListener("keyup", self.key_up)

            def key_down(self, event):
                self.keys.add(event.key)

            def key_up(self, event):
                self.keys.discard(event.key)

            def dibujar(self):
                # Limpiar canvas
                self.ctx.fillStyle = COLOR_FONDO
                self.ctx.fillRect(0, 0, ANCHO, ALTO)

                # Dibujar jugador
                self.jugador.dibujar(self.ctx)

                # Dibujar enemigos
                for enemigo in self.enemigos:
                    enemigo.dibujar(self.ctx)

            def actualizar(self):
                # Mover jugador
                self.jugador.mover(self.keys)

                # Verificar colisiones con enemigos
                for enemigo in self.enemigos:
                    if enemigo.colisiona(self.jugador):
                        self.enemigos.remove(enemigo)
                        self.puntuacion += 10
                        document.getElementById("score").innerText = f"Puntuación: {self.puntuacion}"

                # Ganar el juego
                if self.puntuacion >= PUNTOS_GANAR:
                    self.ganar()

            def ganar(self):
                alert("¡Has ganado!")
                window.location.reload()

            def iniciar(self):
                def loop():
                    self.actualizar()
                    self.dibujar()
                    window.requestAnimationFrame(loop)
                loop()

        # Iniciar juego
        juego = Juego()
        juego.iniciar()
    </py-script>
</body>
</html>
